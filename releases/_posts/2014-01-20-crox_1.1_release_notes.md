---
layout: post
title: 2013-12-09 - Crox发布1.1版本
---

{% raw %}

## 高性能跨语言模板引擎Crox

Crox是一个由JavaScript语言实现的高性能跨语言模板引擎。Crox模板可以直接在JavaScript环境中使用，也可以翻译成PHP等其他编程语言的可执行方法或翻译成Velocity等其他模板引擎的源模板，Crox通过独有的模板逻辑“直译”技术确保翻译后的结果具备最佳执行效率。
	
### 1 为什么“又”做一个模板引擎
全端时代的展现端多样化迫使后端服务纯数据化改造进程加快，而在前端领域依靠前端构造展现的WebAPP架构与后台输出展现的传统架构将长期共存。在此背景下一个能够在多种架构环境中广泛适用的跨语言模板引擎将带给我们:

* 不同Web架构间从数据到HTML的构建过程的统一，这样：
  * 不同架构间的前端组件和区块可以共享复用
  * 前端工程师改开发Demo为开发模板，降低“套页面”引入的质量风险
* 促成新型的同时支持前后端渲染的前端架构，可以：
  * 解决单页应用站点内容无法被搜索引擎抓取的问题
  * 让移动端在省电模式（高网速后台渲染）和省流量模式（低网速前台渲染）中灵活切换成为可能
* 基于语法、词法分析的模板引擎将有助于区块内基于数据变化进行局部刷新的技术实现

### 2 高性能是跨语言模板引擎能够广泛应用的前提
“高性能”是跨语言全端模板引擎的核心技术指标。因为无论在动辄数千QPS的后端环境下，还是在展现伴随着内存和电力消耗的移动端，模板引擎的性能要求都比在PC端分布式运行的环境里高出太多。那么如何做到高性能呢？

#### 2.1 通过逻辑“直译”保障高效
看一个例子：

![Crox Example](http://strip.taobaocdn.com/tfscom/T1anY3Fc8cXXb1upjX.jpg)

从这个例子可以看出，无论JavaScript还是Php，翻译后代码和大家读模板时直观印象一致，每个位置输出的数据十分明确，遇到判断就是一个判断。这就是Crox强调的逻辑“直译”，它让我们明确每一行代码的性能消耗都是充分和必要的.

#### 2.2 通过明确的API定义保障逻辑"直译"可行
在Crox中我们通过明确的API设计和严格的功能取舍来确保“直译”可行。下面是Crox基础API设计原则：

* 除了在循环中,所有待输出数据需要写出完整的从root开始的路径
* 支持并且明确的区分分支语句和循环语句
* 在循环语句中需要显式指定临时变量，用于指代循环时的当前元素和index
* 仅支持简单的赋值表达式和运算表达式
* 支持子模板引入
* 仅支持以上所述功能

### 3 XTemplate已兼容Crox
虽然Crox支持了大量常见的模板功能，但Crox绝不是万能的，我们这样看待这个问题：

* 首先，Crox更适合展示型页面区块的构建，而带有复杂交互的前端组件（如：日历、文本编辑器），本就无需从后端渲染。
* 其次，在纯前端应用环境下，让功能更强大的前端模板引擎和Crox配合使用形成高低搭配。

最新版本的XTemplate，已兼容Crox语法。在Crox力有不逮时，XTemplate可以以随时接手；在应对简单任务时，Crox是XTemplate外的另一个选择。如果亲熟悉XTemplate用法，记住几个约定即可上手Crox。

### 4 Crox未来
* 增加多个翻译目标，面向Velocity翻译正在进行中，欢迎亲们提出需求或参与共建
* 研发区块内基于数据变化进行局部刷新的技术
* 提供工程内模板批量离线编译工具

### 5 Crox1.1 发布
* Crox已经为Kissy，SeaJS，AMD，Node和浏览器原生JavaScript环境准备好了，试用群：891026490，欢迎亲们试用，给出宝贵意见
* Crox由阿里妈妈用户体验中心的三冰同学负责核心技术实现，由李牧和三冰共同完成设计
* 特别感谢承玉调整XTemplate以兼容Crox
* 感谢陆辉、沉鱼、玉伯、胡伯为Crox提供自动化测试套件
* 感谢行列、基德、水鱼、寒泉、龙笛等同学在各个阶段对项目的贡献
* Crox从最初构思到反复几版的设计和实践，几经波折，感谢梓佑、杨逍和各位前端小伙伴们的支持

{% endraw %}